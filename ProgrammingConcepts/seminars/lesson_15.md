# 15. Недетерминизм и время

Мы разобрались, как добавлять в программу параллелизм и состояние по отдельности. Но если мы добавим обе эти возможности одновременно, программа от вызова к вызову может выдавать разные результаты на одних и тех же входных данных. Так случается потому, что нити могут получать доступ к состояниям в непредсказуемом порядке, который зависит от внешних условий. Подобная изменчивость называется недетерминизм. Его причина в том, что точное время, когда будет выполнена та или иная инструкция в программе, теперь неизвестно -- потому что нити работают независимо и не представляют, какие инструкции выполняются в других нитях.

Сам по себе недетерминизм не проблема: мы уже сталкивались с ним, когда разбирались с параллелизмом. Трудности начинаются, когда возникает наблюдаемый недетерминизм (уже упоминавшаяся ранее конкуренция, race condition).

Возьмём простой пример с нитями:

global a = 0

Thread 2:
a = 1

Thread 3:
a = 2
В результате такой работы в ячейке "a" будет либо 1 либо 2 -- но мы не можем заранее предсказать, что именно.

Однако проблемы наблюдаемого недетерминизма гораздо глубже.