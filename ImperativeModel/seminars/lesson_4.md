# 4. Принцип абстракции

Какой должна быть система, чтобы обеспечить наилучшую поддержку принципа абстракции?

У неё должны присутствовать три ключевые характеристики:
- Инкапсуляция: возможность скрывать внутренние части системы;
- Композиционность: возможность комбинировать части системы, чтобы получать новые части;
- Instantiation/invocation: возможность создания множества экземпляров на основе единого их определения. После своего создания экземпляры самоподключаются к своему окружению, в котором будут существовать.

Даже поверхностным взглядом на эти характеристики программист, знакомый с ООП, выделит знакомые концепции: инкапсуляция уже присутствует; классы можно комбинировать путём наследования или композиции; на основе класса как типа данных можно создавать экземпляры, объекты, которые сразу же доступны для работы.

Но мы применяем научный подход и используем более универсальные, формальные и фундаментальные принципы программирования. Например, замыкания обеспечивают инкапсуляцию, и программирование высших порядков обеспечивает инстанцирование (создание экземпляров).

Важная особенность такого набора характеристик, что он не требует напрямую использования концепции состояния.

Инкапсуляция, формально говоря, вообще ортогональна состоянию, и её вполне можно применять в декларативном программировании, а состояния могут обходиться без инкапсуляции (например, через создание глобальных переменных).

Однако простое добавление состояния к декларативному программированию резко усложняет возможность рассуждения о программе, серьёзно затрудняет её понимание. Это прежде всего побочные эффекты, когда функция может менять состояния, которые видимы во всей остальной программе. Поэтому явное состояние правильно всегда применять в тесной связке с инкапсуляцией. Тогда появляется возможность проектировать stateful-системы корректно, для чего вводится понятие инварианта, который всегда правилен, если смотреть на него извне, "снаружи". Таким образом мы снова можем рассуждать о каждой подсистеме достаточно формально, считая, что её поведение не зависит от окружающей среды, что частично приближает нас к комфортному в этом плане декларативному программированию. Однако даже использование инвариантов не делает программировании с помощью состояний таким простым, как декларативное.

Инвариант сам по себе просто определяет, что некоторый компонент не ведет себя некорректно, но не гарантирует, что он помогает в продвижении к итоговой цели (решению). Хорошее правило для сложных систем -- создавать как можно больше компонентов в декларативной парадигме. Состояние не должно быть "размазано" по многим компонентам, его надо концентрировать буквально в единичных тщательно отобранных компонентах.